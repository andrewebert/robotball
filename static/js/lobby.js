// Generated by CoffeeScript 1.10.0
var app;

app = angular.module('lobbyApp', ['socket']);

app.controller('LobbyCtrl', [
  '$scope', '$window', 'socket', function($scope, $window, socket) {
    $scope.id = void 0;
    $scope.gotPlayers = false;
    $scope.players = [];
    socket.onmessage(function(data) {
      var method, player;
      console.log(data);
      method = data.method;
      if (method === 'setId') {
        $scope.id = data.userId;
      } else if (method === 'setPlayers') {
        $scope.players = data.players;
        $scope.gotPlayers = true;
      } else if (method === 'addPlayer') {
        if ($scope.gotPlayers) {
          $scope.players.push({
            userId: data.userId,
            name: data.name
          });
        }
      } else if (method === 'removePlayer') {
        $scope.players = (function() {
          var i, len, ref, results;
          ref = $scope.players;
          results = [];
          for (i = 0, len = ref.length; i < len; i++) {
            player = ref[i];
            if (player.userId !== data.userId) {
              results.push(player);
            }
          }
          return results;
        })();
      } else if (method === 'startGame') {
        console.log("Started game with " + data.opponent);
        $window.location.href = $window.location.origin + "/game/" + $scope.id;
      }
    });
    $scope.startGame = function(opponentId) {
      return socket.send({
        method: "startGame",
        opponent: opponentId
      });
    };
    $scope.setUsername = function(username) {
      return socket.send({
        method: "setName",
        name: username
      });
    };
    return $window.onbeforeunload = function() {
      return socket.send({
        method: "leave"
      });
    };
  }
]);
